<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Status + Custom Body Tester</title>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; padding: 32px; background:#fafafa; }
  .card { max-width:760px; margin:0 auto; background:white; padding:20px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  label { display:block; margin-top:12px; font-weight:600; }
  input[type="number"], input[type="text"], select, textarea { width:100%; padding:10px; margin-top:6px; border-radius:6px; border:1px solid #ddd; font-size:14px; box-sizing:border-box;}
  textarea { min-height:120px; font-family:inherit; }
  .controls { display:flex; gap:10px; margin-top:12px; }
  button { padding:10px 14px; border-radius:8px; border:0; background:#0b69ff; color:white; font-weight:600; cursor:pointer; }
  pre { background:#f6f8fa; padding:12px; border-radius:8px; overflow:auto; max-height:300px;}
  .meta { display:flex; gap:12px; flex-wrap:wrap; margin-top:12px; }
  .chip { padding:6px 10px; border-radius:999px; background:#eef2ff; color:#1e3a8a; font-weight:600; }
</style>
</head>
<body>
  <div class="card">
    <h1>Status + Custom Body Tester</h1>
    <p>Enter a status code and a custom response body. Replace <code>YOUR_WORKER_URL</code> with your worker URL.</p>

    <label>Worker URL
      <input id="workerUrl" type="text" placeholder="https://freednstest.denvorsmith289.workers.dev" value="https://freednstest.denvorsmith289.workers.dev">
    </label>

    <label>Status code
      <input id="statusCode" type="number" value="200" min="100" max="599">
    </label>

    <label>HTTP method
      <select id="method">
        <option>GET</option>
        <option>POST</option>
      </select>
    </label>

    <label>Response Content-Type (e.g. text/plain, application/json)
      <input id="contentType" type="text" value="text/plain; charset=utf-8">
    </label>

    <label>Custom response body
      <textarea id="body">Hello World</textarea>
    </label>

    <div class="controls">
      <button id="sendBtn">Send request</button>
      <button id="sendJsonBtn">Send as JSON (sets Content-Type to application/json)</button>
      <button id="clearBtn" style="background:#e5e7eb;color:#111">Clear</button>
    </div>

    <div class="meta" style="margin-top:16px;">
      <div class="chip">CORS: Worker must set <code>Access-Control-Allow-Origin</code></div>
      <div class="chip">Tip: Worker supports GET (body via ?body=...) or POST (body in request)</div>
    </div>

    <h3>Result</h3>
    <div id="resultArea">
      <div><strong>Status:</strong> <span id="resStatus">—</span></div>
      <div><strong>Headers:</strong></div>
      <pre id="resHeaders">—</pre>
      <div><strong>Body:</strong></div>
      <pre id="resBody">—</pre>
    </div>
  </div>

<script>
  const sendBtn = document.getElementById('sendBtn');
  const sendJsonBtn = document.getElementById('sendJsonBtn');
  const clearBtn = document.getElementById('clearBtn');
  const workerUrlEl = document.getElementById('workerUrl');
  const statusCodeEl = document.getElementById('statusCode');
  const methodEl = document.getElementById('method');
  const contentTypeEl = document.getElementById('contentType');
  const bodyEl = document.getElementById('body');

  const resStatus = document.getElementById('resStatus');
  const resHeaders = document.getElementById('resHeaders');
  const resBody = document.getElementById('resBody');

  function showResult(status, headersObj, text) {
    resStatus.textContent = status + ' ' + (status >= 100 && status < 600 ? '' : '');
    resHeaders.textContent = JSON.stringify(headersObj, null, 2);
    resBody.textContent = text;
  }

  async function doSend(asJson=false) {
    const base = workerUrlEl.value.trim();
    if (!base) return alert('Enter your worker URL');
    const code = Number(statusCodeEl.value) || 200;
    const method = methodEl.value || 'GET';
    let ct = contentTypeEl.value || 'text/plain; charset=utf-8';
    let body = bodyEl.value || '';

    if (asJson) {
      ct = 'application/json; charset=utf-8';
      // try to pretty-print if it's JSON-ish
      try { JSON.parse(body); } catch(e) { /* leave as-is */ }
    }

    // Build URL
    const url = new URL(base);
    url.searchParams.set('code', String(code));
    url.searchParams.set('ct', ct);

    try {
      let fetchOpts = {
        method,
        headers: { 'x-client-content-type': ct }, // fallback header the worker reads
      };

      if (method === 'GET') {
        // send body via query param in GET to support workers that rely on it
        url.searchParams.set('body', body);
      } else {
        // POST: send body as request body
        fetchOpts.body = body;
        fetchOpts.headers['Content-Type'] = ct;
      }

      // Always allow CORS mode
      const resp = await fetch(url.toString(), fetchOpts);

      // Read headers into object
      const headersObj = {};
      resp.headers.forEach((v,k) => headersObj[k] = v);

      // Read body as text (handles any status)
      let text = '';
      try { text = await resp.text(); } catch(e) { text = `<unable to read body: ${e}>`; }

      showResult(resp.status + ' ' + resp.statusText, headersObj, text);
    } catch (err) {
      showResult('ERROR', {}, String(err));
    }
  }

  sendBtn.addEventListener('click', () => doSend(false));
  sendJsonBtn.addEventListener('click', () => doSend(true));
  clearBtn.addEventListener('click', () => {
    bodyEl.value = '';
    resStatus.textContent = '—';
    resHeaders.textContent = '—';
    resBody.textContent = '—';
  });
</script>
</body>
</html>
